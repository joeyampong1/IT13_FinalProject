@inherits LayoutComponentBase

<div class="dashboard-layout">
    <aside class="dashboard-sidebar">
        <div class="sidebar-logo">
            <img src="/images/Final_logo-removebg-preview.png" alt="MedFlow Logo" class="sidebar-logo-img" />
            <span class="sidebar-app-name">MedFlow</span>
        </div>

        <nav class="sidebar-section">
            <div class="sidebar-section-title">MAIN</div>
            <button class="sidebar-item @(IsDashboardActive ? "active" : string.Empty)" @onclick="OnDashboardClick">ğŸ  Dashboard</button>
        </nav>

        <nav class="sidebar-section">
            <div class="sidebar-section-title">MODULES</div>
            <button class="sidebar-item @(IsPatientManagementActive ? "active" : string.Empty)" @onclick="OnPatientManagementClick">ğŸ§‘â€âš•ï¸ Patient Management</button>
            <button class="sidebar-item @(IsHealthRecordActive ? "active" : string.Empty)" @onclick="OnHealthRecordClick">ğŸ“‹ Health Record</button>
            <button class="sidebar-item">ğŸ’³ Invoicing &amp; Cashiering</button>
            <button class="sidebar-item">ğŸ§¾ Insurance &amp; Claims</button>
            <button class="sidebar-item">ğŸ’Š Pharmacy &amp; Inventory</button>
            <button class="sidebar-item">ğŸ“Š Reports / Analytics</button>
        </nav>

        <nav class="sidebar-section">
            <div class="sidebar-section-title">USER MANAGEMENT</div>
            <button class="sidebar-item sidebar-item-expand" @onclick="ToggleUserMenu">
                ğŸ‘¥ User
                <span class="sidebar-chevron">@(IsUserMenuExpanded ? "â–¾" : "â–¸")</span>
            </button>

            @if (IsUserMenuExpanded)
            {
                <button class="sidebar-subitem">ğŸ‘¤ User Profile</button>
                <button class="sidebar-subitem">ğŸ§© Role</button>
                <button class="sidebar-subitem">ğŸ›¡ï¸ Permission</button>
            }
        </nav>

        <nav class="sidebar-section">
            <div class="sidebar-section-title">SYSTEM</div>
            <button class="sidebar-item">ğŸ“œ Audit Logs</button>
            <button class="sidebar-item">ğŸ”„ Sync Management</button>
            <button class="sidebar-item">âš™ï¸ Settings</button>
        </nav>

        <button class="sidebar-logout" @onclick="LogoutAsync">LOG OUT</button>
    </aside>

    <div class="dashboard-main">
        @Body
    </div>
</div>

@code {
    [Inject]
    private NavigationManager Navigation { get; set; } = default!;

    // JS runtime used to show a simple browser confirm dialog
    [Inject]
    private IJSRuntime JsRuntime { get; set; } = default!;

    private bool IsDashboardActive => Navigation.Uri.Contains("/dashboard", StringComparison.OrdinalIgnoreCase);

    private bool IsPatientManagementActive => Navigation.Uri.Contains("/patient-management", StringComparison.OrdinalIgnoreCase);

    private bool IsHealthRecordActive =>
        Navigation.Uri.Contains("/health-records", StringComparison.OrdinalIgnoreCase)
        || Navigation.Uri.Contains("/patient-records", StringComparison.OrdinalIgnoreCase)
        || Navigation.Uri.Contains("/patient-ehr-print", StringComparison.OrdinalIgnoreCase);

    private bool IsUserMenuExpanded { get; set; }

    private void OnDashboardClick() => Navigation.NavigateTo("/dashboard");

    private void OnPatientManagementClick() => Navigation.NavigateTo("/patient-management");

    private void OnHealthRecordClick() => Navigation.NavigateTo("/health-records");

    private void ToggleUserMenu()
    {
        IsUserMenuExpanded = !IsUserMenuExpanded;
    }

    // Shows a confirmation dialog before navigating back to the login page
    private async Task LogoutAsync()
    {
        var confirmed = await JsRuntime.InvokeAsync<bool>("confirm", "Are you sure you want to log out?");

        if (confirmed)
        {
            Navigation.NavigateTo("/login", forceLoad: true);
        }
    }
}
