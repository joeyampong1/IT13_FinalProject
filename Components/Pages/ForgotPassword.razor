@page "/forgot-password"
@layout Layout.EmptyLayout

<div class="reset-page">
    <div class="reset-card">
        <h2 class="reset-title">Reset Password</h2>

        <div class="reset-icon-wrapper">
            <div class="reset-icon">?</div>
        </div>

        <EditForm Model="this" OnValidSubmit="HandleContinue">
            <DataAnnotationsValidator />

            @if (!IsOtpStep && !IsNewPasswordStep)
            {
                <div class="reset-label">Enter Recovery Email</div>
                <InputText class="reset-input" @bind-Value="RecoveryEmail" type="email" />

                <div class="reset-actions">
                    <button type="button" class="btn-secondary" @onclick="Cancel">Cancel</button>
                    <button type="submit" class="btn-primary">Continue</button>
                </div>
            }
            else if (IsOtpStep && !IsNewPasswordStep)
            {
                <div class="reset-label">Enter OTP</div>
                <InputText class="reset-input" @bind-Value="OtpCode" />

                <div class="reset-actions single">
                    <button type="submit" class="btn-primary">Continue</button>
                </div>
            }
            else if (IsNewPasswordStep)
            {
                <div class="reset-label">Enter New Password</div>
                <InputText class="reset-input" @bind-Value="NewPassword" type="password" />

                <div class="reset-label" style="margin-top: 12px;">Confirm New Password</div>
                <InputText class="reset-input" @bind-Value="ConfirmNewPassword" type="password" />

                <div class="reset-actions single" style="margin-top: 24px;">
                    <button type="submit" class="btn-primary">Continue</button>
                </div>
            }
        </EditForm>

        <div class="reset-footer-text">
            <span>Terms of Use.</span>
            <span>Privacy Policy.</span>
        </div>
    </div>
</div>

@code {
    public string? RecoveryEmail { get; set; }
    public string? OtpCode { get; set; }
    public string? NewPassword { get; set; }
    public string? ConfirmNewPassword { get; set; }
    public bool IsOtpStep { get; set; }
    public bool IsNewPasswordStep { get; set; }

    [Inject]
    private NavigationManager Navigation { get; set; } = default!;

    private void Cancel()
    {
        Navigation.NavigateTo("/login");
    }

    private void HandleContinue()
    {
        if (!IsOtpStep && !IsNewPasswordStep)
        {
            // Step 1: temporary email check to proceed to OTP panel
            if (string.Equals(RecoveryEmail, "admin@gmail.com", StringComparison.OrdinalIgnoreCase))
            {
                IsOtpStep = true;
            }
            else
            {
                // TODO: handle invalid email case (show message, etc.)
            }
        }
        else if (IsOtpStep && !IsNewPasswordStep)
        {
            // Step 2: temporary OTP check to proceed to new password panel
            if (string.Equals(OtpCode, "123098", StringComparison.OrdinalIgnoreCase))
            {
                IsOtpStep = false;
                IsNewPasswordStep = true;
            }
            else
            {
                // TODO: handle invalid OTP case (show message, etc.)
            }
        }
        else if (IsNewPasswordStep)
        {
            // Step 3: here you would save the new password
            // TODO: validate and persist new password, then navigate or confirm success
        }
    }
}
